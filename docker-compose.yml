version: '3.1'
services:
  prometheus:
    build:
      context: ./prometheus
      dockerfile: dockerfile
    container_name: "prometheus"
    hostname: "prometheus"
    ports:
      - "9090:9090"
    links:   MvcApp 
      - 

  grafana:
    image: grafana/grafana
    container_name: "grafana"
    hostname: "grafana"
    ports:
      - "3000:3000"
    links:
      - prometheus
      
  alertmanager:
    build:
      context: ./alertmanager
      dockerfile: dockerfile
    container_name: "alert-manager"
    hostname: "alert-manager"
    command:
      - '--config.file=/etc/prometheus/alertmanager.yml'
    ports:
      - '9093:9093'
    links:    
      - prometheus
  
  MvcApp:
    image:erakm5493/devops:latest
    container_name: "MvcApp"
    hostname: "MvcApp"
    ports:
      - "80:80"
    environment:
        ConnectionStrings__ProductsContext: "Server=db;Database=ProductsContext;User=sa;Password=@Aa123456;"
    depends_on:
      - db  
  db:
    image: "microsoft/mssql-server-linux"    
    container_name: "MvcApp"
    expose:
    environment:
    SA_PASSWORD: "@Aa123456"
    ACCEPT_EULA: "Y"
    ports:
      - "1433:1433"
 